<meta charset="utf-8">

<style>
	#box1 { width: 960px; height: 400px; margin-top: 50px; }
	#box2 { width: 300px; height: 150px; margin-left: 500px; }

	.foresee { border: 1px solid grey }
	.foresee_file { background: pink }
	.foresee_data { background: lightgreen }
	.foresee_graph { background: lightyellow }
	.foresee_panel { background: lightcyan }
	.foresee_panel_tabs { background: lightcyan }
	.foresee_filter { background: lightblue }
</style>



<script>
initialize = function(box){
	box.innerHTML += `
		<div class='foresee_data'>
			<table>
				<tr><td>Time</td><td>Data</td><td>Fit</td><td>Weight</td><td>Error</td></tr>
			</table>
			<input class='foresee_file' type="file">
			<div class="foresee_data_slider" onmousedown="startSlider(event)"></div>
		</div>

		<div class="foresee_graph">
			Graph
		</div>

		<div class="foresee_panel">
			<div class="foresee_panel_tabs" onmousedown="startSlider(event)">
				<div class="foresee_tab" onclick="foresee_openTab(event, 'foresee_panel_Data')">Data</div>
				<div class="foresee_tab" onclick="foresee_openTab(event, 'foresee_panel_Time')">Time</div>
				<div class="foresee_tab" onclick="foresee_openTab(event, 'foresee_panel_Graph')">Graph</div>
				<div class="foresee_tab" onclick="foresee_openTab(event, 'foresee_panel_Error')">Error</div>
				<div class="foresee_tab" onclick="foresee_openTab(event, 'foresee_panel_Fit')">Fit</div>			
			</div>
			<div class="foresee_tab_panel">Time</div>
			<div class="foresee_tab_panel">Data</div>
			<div class="foresee_tab_panel" style="display: block">Graph</div>
			<div class="foresee_tab_panel">Error</div>
			<div class="foresee_tab_panel">Fit</div>
		</div>

		<ul class="foresee_filter">
			<li>Week</li>
			<li>Month</li>
			<div class="foresee_filter_slider" onmousedown="startSlider(event)">slider</div>			
		</ul>
	`
}
// End initialize


// Load all forecast boxes
window.addEventListener('load', function(event){
	style = document.createElement('style')
	document.head.appendChild(style)
	style.innerHTML = `
		.foresee { position: relative; margin:0; padding: 0; font-family: Verdana, sans-serif; overflow: hidden}
		.foresee * { margin:0; padding: 0; }

		.foresee_data { position: absolute; left: 0; width: 25%; top: 0; height: 100%}
		.foresee_data_slider { position: absolute; right: 0; width: 1em; top: 0; height: 100%}
		.foresee_data_slider:hover { background: whitesmoke; cursor: col-resize }

		.foresee_graph  { position: absolute; left:  25%; right: 25%; top:  0 ; height: 75%; }
		
		.foresee_panel  { position: absolute; left: 25%; right:  0 ; top: 75%; bottom:  0 ; }

		.foresee_filter { position: absolute; width: 25%; right:  0 ; top:  0 ; height: 75%; }
		.foresee_filter_slider { position: absolute; left: 0; width: 1em; top: 0; height: 100%}
		.foresee_filter_slider:hover { background: whitesmoke; cursor: col-resize }

		.foresee_panel_tabs { background: whitesmoke; cursor: row-resize; border: 1px solid lightgrey }
		.foresee_panel_tabs:hover { background: lightgrey; cursor: row-resize }

		.foresee_tab { display: inline-block; padding: .7em 1em; cursor: default; }
		.foresee_tab:hover { background: whitesmoke }
		.foresee_tab[active] { background: #444; color: white }
	`
	for(var foresee of document.querySelectorAll('.foresee'))
		initialize(foresee)
})
// End load all forecast boxes



// Resize sub-windows
var slider
startSlider = function(event){
	event.preventDefault()
	slider = event.target.parentElement
	slider.dy = event.pageY - slider.offsetTop - slider.parentElement.offsetTop
}
window.addEventListener('mouseup', function(){
	slider = null
})
window.addEventListener('mousemove', function(event){
	event.preventDefault()
	if(slider){
	
		if(slider.classList.contains('foresee_panel')){
			var h = Number.parseInt(getComputedStyle(slider.parentElement).height)
			var y = event.pageY - slider.dy - slider.parentElement.offsetTop 
			if(y < 0) y = 0
			if(h-5 < y) y = h-5

			slider.parentElement.querySelector('.foresee_panel').style.top = y+'px'
			slider.parentElement.querySelector('.foresee_graph').style.height = y+'px'
			slider.parentElement.querySelector('.foresee_filter').style.height = y+'px'		
		}

		if(slider.classList.contains('foresee_data')){
			var x = event.pageX - slider.parentElement.offsetLeft
			var w = slider.parentElement.querySelector('.foresee_filter').offsetLeft
			if(x < 5) x = 5
			if(w < x) x = w

			slider.parentElement.querySelector('.foresee_data').style.width = x+'px'
			slider.parentElement.querySelector('.foresee_graph').style.left = x+'px'
			slider.parentElement.querySelector('.foresee_panel').style.left = x+'px'		
		}

		if(slider.classList.contains('foresee_filter')){
			var w = Number.parseInt(getComputedStyle(slider.parentElement).width) + slider.parentElement.offsetLeft
			var x = w - event.pageX + 10
			w = w - slider.parentElement.querySelector('.foresee_graph').offsetLeft - slider.parentElement.offsetLeft
			if(x < 5) x = 5
			if(w < x) x = w

			slider.parentElement.querySelector('.foresee_graph').style.right = x+'px'
			slider.parentElement.querySelector('.foresee_filter').style.width = x+'px'		
		}
	}
})
// End resize sub-windows


// Tab panel
foresee_openTab = function(event, select){
	cosnole.log(event)
	for(var tab of event.target.parentElement.querySelectorAll('.foresee_tab'))
		if(tab.getAttribute('onclick').indexOf(select)>0)
			tab.setAttribute('active', 'active')
		else
			tab.removeAttribute('active')
	for(var tab of event.target.parentElement.parentElement.querySelectorAll('.foresee_panel *'))
		if(tab.classList.contains(select))
			tab.style.display = 'block'
		else
			tab.style.display = 'none'
}

// End Control panel

</script>

<body>
	<div id="box1" class="foresee">box1</div>
	<div id="box2" class="foresee">box2</div>
</body>
